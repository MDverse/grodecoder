# GROdecoder üî¨

**GROdecoder** is a powerful Python toolkit for extracting and identifying molecular components from structure files (PDB, GRO, CRD, COOR) generated by molecular dynamics simulations. It automatically detects and classifies proteins, nucleic acids, lipids, ions, solvents, and other small molecules, providing detailed molecular inventories in JSON format.

[![Python Version](https://img.shields.io/badge/python-‚â•3.13-blue.svg)](https://python.org)
[![License](https://img.shields.io/badge/license-BSD--3--Clause-green.svg)](LICENSE)

## üåü Features

- **Automatic Molecule Detection**: Intelligently identifies proteins, nucleic acids, lipids, ions, solvents, and unknown molecules
- **Chain Segmentation**: Detects individual protein/nucleic acid chains using distance-based connectivity analysis
- **Resolution Detection**: Automatically determines if structures are all-atom or coarse-grained
- **Comprehensive Database**: Built-in databases from CHARMM-GUI CSML and MAD for accurate molecular identification
- **Multiple Output Formats**: Full or compact JSON serialization with optional atom indices
- **Flexible Input**: Supports PDB, GRO, CRD, and COOR file formats
- **Web Interface**: User-friendly Streamlit web application
- **Command Line Tool**: Batch processing capabilities for high-throughput analysis

## üöÄ Quick Start

### Installation

GROdecoder uses [uv](https://docs.astral.sh/uv/) for dependency management:

```bash
git clone https://github.com/pierrepo/grodecoder.git
cd grodecoder
uv sync
```

### Basic Usage

**Command Line:**
```bash
# Analyze a structure file
uv run grodecoder path/to/structure.gro

# Output to stdout with compact format
uv run grodecoder structure.pdb --compact --stdout

# Custom bond threshold for chain detection
uv run grodecoder structure.gro --bond-threshold 3.5
```

**Python API:**
```python
import grodecoder as gd

# Decode a structure file
decoded = gd.decode_structure("structure.gro")

# Access the molecular inventory
inventory = decoded.inventory
print(f"Found {len(inventory.segments)} protein/nucleic chains")
print(f"Found {len(inventory.small_molecules)} small molecules")

# Get specific molecule types
proteins = [seg for seg in inventory.segments
           if seg.molecular_type == gd.MolecularType.PROTEIN]
lipids = [mol for mol in inventory.small_molecules
          if mol.molecular_type == gd.MolecularType.LIPID]
```

**Web Interface:**
```bash
uv run streamlit run scripts/streamlit_app.py
```
Then open your browser at http://localhost:8501

## üìä Output Format

GROdecoder produces detailed JSON inventories with the following structure:

```json
{
  "inventory": {
    "segments": [
      {
        "atoms": [0, 1, 2, ...],
        "sequence": "MKALTARQQEVFDLIRDHISQTGMPPTRAEIAQRLGFRSPNAAEEHLKALARKGVIEIV...",
        "molecular_type": "protein",
        "number_of_atoms": 1434,
        "number_of_residues": 89
      }
    ],
    "small_molecules": [
      {
        "atoms": [8080, 8081, 8082, ...],
        "name": "SOL",
        "description": "Water (TIP3P model)",
        "molecular_type": "solvent",
        "number_of_atoms": 17259,
        "number_of_residues": 5753
      }
    ]
  },
  "resolution": "all-atom",
  "database_version": "1.0.0"
}
```

## üîß Advanced Features

### Chain Detection
GROdecoder uses sophisticated distance-based algorithms to detect protein and nucleic acid chains:

```python
# Detect chains with custom cutoff
decoded = gd.decode_structure("multi_chain.pdb", bond_threshold=4.0)

# Access individual chains
for i, chain in enumerate(decoded.inventory.segments):
    print(f"Chain {i+1}: {len(chain.sequence)} residues")
```

### Molecular Type Classification
The toolkit categorizes molecules into six types:
- **Proteins**: Amino acid sequences
- **Nucleic Acids**: DNA/RNA sequences
- **Lipids**: Membrane components from CHARMM-GUI and MAD databases
- **Ions**: Inorganic ions (Na+, Cl-, Ca2+, etc.)
- **Solvents**: Water models and organic solvents
- **Unknown**: Unidentified small molecules

### Resolution Detection
Automatically distinguishes between:
- **All-atom**: High-resolution structures with complete atomic detail
- **Coarse-grained**: Simplified representations with grouped atoms

## üóÉÔ∏è Database System

GROdecoder includes comprehensive molecular databases:

### Built-in Databases
- **Amino Acids**: Standard and modified residues
- **Nucleotides**: DNA/RNA bases and modifications
- **Ions**: Common inorganic ions with various protonation states
- **Solvents**: Water models (TIP3P, SPC/E, etc.) and organic solvents

### External Database Integration
- **CHARMM-GUI CSML**: All-atom lipid and small molecule definitions
- **MAD Database**: Coarse-grained molecular definitions

### Database Updates
```bash
# Update CHARMM-GUI CSML database
uv run scripts/build_lipid_database.py

# Update MAD database
uv run scripts/scrap_MAD.py
```

## üß™ Testing

Run the comprehensive test suite:

```bash
# Run all tests
uv run pytest

# Run specific test categories
uv run pytest tests/test_identifier.py  # Core identification tests
uv run pytest tests/test_regression.py  # Regression tests
uv run pytest tests/test_toputils/      # Topology utility tests
```

## ü§ù Contributing

Contributions are welcome! Please feel free to:

1. **Report Issues**: Bug reports and feature requests via GitHub Issues
2. **Submit Pull Requests**: Code improvements and new features
3. **Add Molecules**: Extend the molecular databases
4. **Improve Documentation**: Help make GROdecoder more accessible

## üìÑ License

GROdecoder is released under the **BSD 3-Clause License**. See [LICENSE](LICENSE) for details.

## üë®‚Äçüíª Authors & Acknowledgments

**Created by Pierre Poulain**

Special thanks to:
- Contributors to the CHARMM-GUI CSML database
- MAD (Martini Database) maintainers
- MDAnalysis community
- Beta testers and early adopters

## üîó Links

- **Documentation**: [GitHub Repository](https://github.com/pierrepo/grodecoder)
- **Web Demo**: [Streamlit App](https://grodecoder.streamlit.app/)
- **Issues & Support**: [GitHub Issues](https://github.com/pierrepo/grodecoder/issues)

---

*GROdecoder: Making molecular simulation analysis simple, accurate, and reproducible.*
